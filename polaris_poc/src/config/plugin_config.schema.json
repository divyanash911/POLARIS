{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Managed System Configuration Schema",
  "description": "Schema for validating managed system plugin configurations in POLARIS",
  "type": "object",
  "required": ["system_name", "implementation", "connection", "monitoring", "execution"],
  "properties": {
    "system_name": {
      "type": "string",
      "description": "Name of the managed system",
      "pattern": "^[a-zA-Z0-9_-]+$"
    },
    "system_version": {
      "type": "string",
      "description": "Version of the managed system",
      "default": "1.0.0"
    },
    "implementation": {
      "type": "object",
      "description": "Implementation details for the system connector",
      "required": ["connector_class"],
      "properties": {
        "connector_class": {
          "type": "string",
          "description": "Python import path to the connector class",
          "pattern": "^[a-zA-Z_][a-zA-Z0-9_]*(\\.[a-zA-Z_][a-zA-Z0-9_]*)*$"
        },
        "timeout": {
          "type": "number",
          "description": "Default timeout for operations in seconds",
          "minimum": 0,
          "default": 30
        },
        "max_retries": {
          "type": "integer",
          "description": "Maximum number of retries for failed operations",
          "minimum": 0,
          "default": 3
        }
      }
    },
    "connection": {
      "type": "object",
      "description": "Connection parameters for the managed system",
      "properties": {
        "protocol": {
          "type": "string",
          "description": "Communication protocol",
          "enum": ["tcp", "http", "https", "grpc", "mqtt", "custom"]
        },
        "host": {
          "type": "string",
          "description": "Host address"
        },
        "port": {
          "type": "integer",
          "description": "Port number",
          "minimum": 1,
          "maximum": 65535
        },
        "auth": {
          "type": "object",
          "description": "Authentication configuration",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["none", "basic", "token", "certificate"]
            },
            "credentials": {
              "type": "object",
              "description": "Credential parameters (structure depends on auth type)"
            }
          }
        },
        "ssl": {
          "type": "object",
          "description": "SSL/TLS configuration",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "verify": {
              "type": "boolean",
              "default": true
            },
            "cert_path": {
              "type": "string"
            },
            "key_path": {
              "type": "string"
            }
          }
        }
      }
    },
    "monitoring": {
      "type": "object",
      "description": "Monitoring configuration for the managed system",
      "required": ["metrics"],
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true
        },
        "interval": {
          "type": "number",
          "description": "Monitoring interval in seconds",
          "minimum": 0.1,
          "default": 5
        },
        "metrics": {
          "type": "array",
          "description": "List of metrics to collect",
          "items": {
            "type": "object",
            "required": ["name", "command"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Metric name",
                "pattern": "^[a-zA-Z_][a-zA-Z0-9_]*$"
              },
              "command": {
                "type": "string",
                "description": "Command template to retrieve the metric"
              },
              "unit": {
                "type": "string",
                "description": "Unit of measurement",
                "enum": ["count", "percent", "ratio", "ms", "seconds", "bytes", "KB", "MB", "GB", "req/s", "ops/s", "unknown"]
              },
              "type": {
                "type": "string",
                "description": "Data type of the metric value",
                "enum": ["float", "integer", "boolean", "string"],
                "default": "float"
              },
              "description": {
                "type": "string",
                "description": "Human-readable description of the metric"
              },
              "category": {
                "type": "string",
                "description": "Category for grouping metrics",
                "enum": ["performance", "resource", "availability", "business", "custom"]
              }
            }
          }
        },
        "derived_metrics": {
          "type": "array",
          "description": "Metrics calculated from other metrics",
          "items": {
            "type": "object",
            "required": ["name", "formula"],
            "properties": {
              "name": {
                "type": "string",
                "pattern": "^[a-zA-Z_][a-zA-Z0-9_]*$"
              },
              "formula": {
                "type": "string",
                "description": "Formula to calculate the metric (e.g., 'metric1 + metric2')"
              },
              "unit": {
                "type": "string"
              },
              "description": {
                "type": "string"
              }
            }
          }
        },
        "strategies": {
          "type": "object",
          "description": "Monitoring strategies configuration",
          "properties": {
            "batch_collection": {
              "type": "boolean",
              "description": "Whether to collect metrics in batches",
              "default": true
            },
            "parallel_collection": {
              "type": "boolean",
              "description": "Whether to collect metrics in parallel",
              "default": false
            },
            "max_concurrent": {
              "type": "integer",
              "description": "Maximum concurrent metric collections",
              "minimum": 1,
              "default": 5
            },
            "error_handling": {
              "type": "string",
              "enum": ["skip", "retry", "default", "fail"],
              "default": "skip"
            }
          }
        }
      }
    },
    "execution": {
      "type": "object",
      "description": "Execution configuration for control actions",
      "required": ["actions"],
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true
        },
        "actions": {
          "type": "array",
          "description": "List of available control actions",
          "items": {
            "type": "object",
            "required": ["type", "command"],
            "properties": {
              "type": {
                "type": "string",
                "description": "Action type identifier",
                "pattern": "^[A-Z_]+$"
              },
              "command": {
                "type": "string",
                "description": "Command template for the action"
              },
              "description": {
                "type": "string",
                "description": "Human-readable description of the action"
              },
              "parameters": {
                "type": "array",
                "description": "Parameters required for the action",
                "items": {
                  "type": "object",
                  "required": ["name", "type"],
                  "properties": {
                    "name": {
                      "type": "string",
                      "pattern": "^[a-zA-Z_][a-zA-Z0-9_]*$"
                    },
                    "type": {
                      "type": "string",
                      "enum": ["string", "integer", "float", "boolean"]
                    },
                    "required": {
                      "type": "boolean",
                      "default": false
                    },
                    "default": {
                      "description": "Default value for the parameter"
                    },
                    "validation": {
                      "type": "object",
                      "description": "Validation rules for the parameter",
                      "properties": {
                        "min": {
                          "type": "number"
                        },
                        "max": {
                          "type": "number"
                        },
                        "pattern": {
                          "type": "string"
                        },
                        "enum": {
                          "type": "array"
                        }
                      }
                    }
                  }
                }
              },
              "preconditions": {
                "type": "array",
                "description": "Conditions that must be met before executing the action",
                "items": {
                  "type": "object",
                  "required": ["check", "message"],
                  "properties": {
                    "check": {
                      "type": "string",
                      "description": "Command or expression to evaluate"
                    },
                    "message": {
                      "type": "string",
                      "description": "Error message if precondition fails"
                    }
                  }
                }
              },
              "impact": {
                "type": "object",
                "description": "Expected impact of the action",
                "properties": {
                  "severity": {
                    "type": "string",
                    "enum": ["low", "medium", "high", "critical"]
                  },
                  "reversible": {
                    "type": "boolean",
                    "default": true
                  },
                  "estimated_duration": {
                    "type": "number",
                    "description": "Estimated duration in seconds"
                  }
                }
              }
            }
          }
        },
        "constraints": {
          "type": "object",
          "description": "Global execution constraints",
          "properties": {
            "min_interval": {
              "type": "number",
              "description": "Minimum interval between actions in seconds",
              "minimum": 0,
              "default": 0
            },
            "max_concurrent": {
              "type": "integer",
              "description": "Maximum concurrent action executions",
              "minimum": 1,
              "default": 1
            },
            "queue_size": {
              "type": "integer",
              "description": "Maximum action queue size",
              "minimum": 1,
              "default": 1000
            }
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata for the managed system",
      "properties": {
        "author": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "documentation": {
          "type": "string",
          "format": "uri"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    }
  }
}
