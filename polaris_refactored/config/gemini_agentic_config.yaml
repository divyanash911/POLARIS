# POLARIS Framework - Gemini Agentic LLM Configuration
# This configuration enables the full agentic reasoning system with:
# - Google Gemini LLM for intelligent reasoning
# - Knowledge Base for pattern storage and retrieval
# - Statistical World Model for predictions
# - Threshold Reactive Strategy as fallback
# - All monitoring and observability features
# - Persistent logging and metrics storage

# Framework Core Configuration
framework:
  service_name: "polaris-gemini-agentic"
  version: "2.0.0"
  environment: "development"
  
  # NATS Message Bus Configuration (not required for basic testing)
  nats_config:
    servers:
      - "nats://localhost:4222"
    timeout: 30
    
  # Telemetry Configuration
  telemetry_config:
    enabled: true
    collection_interval: 5
    batch_size: 50
    retention_days: 7
    
  # Logging Configuration - Human readable on console, JSON in file
  logging_config:
    level: "DEBUG"
    format: "dual"                              # Console: human-readable, File: JSON
    output: "both"                              # Log to both console and file
    file_path: "./logs/polaris_gemini_agentic.log"
    max_file_size: 52428800                     # 50MB per file
    backup_count: 10                            # Keep 10 backup files
    
  # Framework Settings
  plugin_search_paths:
    - "./plugins"
  max_concurrent_adaptations: 5
  adaptation_timeout: 120

# LLM Configuration - Google Gemini
llm:
  provider: "google"
  api_endpoint: "https://generativelanguage.googleapis.com"
  api_key: "${GEMINI_API_KEY}"
  model_name: "gemini-2.5-flash"
  max_tokens: 4096                              # Increased for longer responses
  temperature: 0.1
  timeout: 60.0
  max_retries: 3
  retry_delay: 2.0
  cache_ttl: 300
  enable_function_calling: true

# Managed Systems Configuration
managed_systems:
  mock_system:
    system_id: "mock_system"
    connector_type: "mock_system"
    enabled: true
    
    connection_params:
      host: "localhost"
      port: 5000
      timeout: 10.0
      max_retries: 3
      retry_delay: 1.0
      
    monitoring_config:
      collection_interval: 5
      collection_strategy: "polling_direct_connector"
      health_check_interval: 15
      metrics_to_collect:
        - "cpu_usage"
        - "memory_usage"
        - "response_time"
        - "throughput"
        - "error_rate"
        - "active_connections"
        - "capacity"

# Control & Reasoning Configuration
control_reasoning:
  # Adaptive Controller Configuration
  adaptive_controller:
    enabled: true
    control_strategies:
      - "threshold_reactive"
      - "agentic_llm_reasoning"
    enable_pid_strategy: false
    enable_enhanced_assessment: true
    
  # Agentic LLM Reasoning Configuration
  agentic_llm_reasoning:
    enabled: true
    max_iterations: 10
    confidence_threshold: 0.7
    enable_tool_usage: true
    available_tools:
      - "query_world_model"
      - "query_knowledge_base"
      - "analyze_system_state"
      - "simulate_adaptation_impact"
      - "get_historical_data"
      - "get_system_dependencies"
    reasoning_timeout: 45.0
    fallback_on_failure: true
    
  # Threshold Reactive Strategy Configuration (Fallback)
  threshold_reactive:
    enabled: true
    enable_multi_metric_evaluation: true
    action_prioritization_enabled: true
    max_concurrent_actions: 3
    default_cooldown_seconds: 30.0
    enable_fallback: true
    
    rules:
      # High CPU - Scale Up
      - rule_id: "high_cpu_scale_up"
        name: "High CPU Scale Up"
        description: "Scale up when CPU utilization exceeds 80%"
        enabled: true
        priority: 3
        cooldown_seconds: 30.0
        logical_operator: "and"
        action_type: "SCALE_UP"
        action_parameters:
          reason: "high_cpu_utilization"
          increment: 1
        conditions:
          - metric_name: "cpu_usage"
            operator: "gt"
            value: 80.0
            weight: 1.0
            
      # Low CPU - Scale Down
      - rule_id: "low_cpu_scale_down"
        name: "Low CPU Scale Down"
        description: "Scale down when CPU utilization is below 20%"
        enabled: true
        priority: 2
        cooldown_seconds: 60.0
        logical_operator: "and"
        action_type: "SCALE_DOWN"
        action_parameters:
          reason: "low_cpu_utilization"
          decrement: 1
        conditions:
          - metric_name: "cpu_usage"
            operator: "lt"
            value: 20.0
            weight: 1.0
            
      # High Response Time - Optimize
      - rule_id: "high_response_time"
        name: "High Response Time"
        description: "Optimize when response time exceeds 500ms"
        enabled: true
        priority: 2
        cooldown_seconds: 45.0
        logical_operator: "or"
        action_type: "OPTIMIZE_CONFIG"
        action_parameters:
          reason: "high_response_time"
        conditions:
          - metric_name: "response_time"
            operator: "gt"
            value: 500.0
            weight: 1.0
            
      # High Error Rate - Restart
      - rule_id: "high_error_rate"
        name: "High Error Rate"
        description: "Restart service when error rate exceeds 10%"
        enabled: true
        priority: 4
        cooldown_seconds: 120.0
        logical_operator: "and"
        action_type: "RESTART_SERVICE"
        action_parameters:
          reason: "high_error_rate"
        conditions:
          - metric_name: "error_rate"
            operator: "gt"
            value: 10.0
            weight: 2.0
            
    severity_weights:
      critical: 3.0
      high: 2.0
      medium: 1.0
      low: 0.5

# Digital Twin Configuration - ALL ENABLED
digital_twin:
  # World Model Configuration
  world_model:
    type: "statistical"
    conversation_history_limit: 20
    enable_fallback_model: true
    prediction_horizon: 10
    confidence_threshold: 0.6
    
  # Knowledge Base Configuration - ENABLED
  knowledge_base:
    enabled: true
    state_retention_hours: 24
    max_state_entries: 2000
    pattern_detection_enabled: true
    dependency_tracking_enabled: true
    
  # Learning Engine Configuration - ENABLED
  learning_engine:
    enabled: true
    learning_rate: 0.1
    pattern_threshold: 0.7
    min_samples_for_learning: 10

# Data Storage Configuration
data_storage:
  backends:
    time_series: "in_memory"
    document: "in_memory"
    graph: "in_memory"
  
  repositories:
    system_state:
      retention_hours: 24
      max_entries: 2000
    adaptation_actions:
      retention_hours: 24
      max_entries: 1000
    execution_results:
      retention_hours: 24
      max_entries: 1000
    learned_patterns:
      retention_hours: 168
      max_entries: 500

# Event Bus Configuration
event_bus:
  max_queue_size: 2000
  worker_count: 4
  enable_event_history: true
  event_history_limit: 1000

# Observability Configuration
observability:
  service_name: "polaris-gemini-agentic"
  enable_metrics: true
  enable_tracing: true
  enable_logging: true
  
  metrics:
    collection_interval: 5
    export_interval: 10
    enable_system_metrics: true
    enable_adaptation_metrics: true
    enable_llm_metrics: true
    
  tracing:
    sample_rate: 1.0
    enable_adaptation_tracing: true
    enable_llm_tracing: true
    
  logging:
    enable_structured_logging: true
    log_level: "DEBUG"
    enable_correlation_ids: true

# Plugin Configuration
plugins:
  mock_system:
    enabled: true
    auto_load: true
    config_validation: true
