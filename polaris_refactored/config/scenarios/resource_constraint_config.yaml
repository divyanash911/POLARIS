# POLARIS Configuration for Resource Constraint Test Scenario
# This scenario tests optimization adaptations under resource constraints

# Inherit from base mock system configuration
extends: "../mock_system_config.yaml"

# Override specific settings for resource constraint scenario
framework:
  service_name: "polaris-mock-system-resource-constraint"
  
managed_systems:
  mock_system:
    system_id: "mock_system_resource_constraint"
    
    # Frequent monitoring for resource constraint scenario
    monitoring_config:
      collection_interval: 4
      
control_reasoning:
  threshold_reactive:
    # Focus on optimization and efficiency adaptations
    rules:
      # Disable scale-up to simulate resource constraints
      - rule_id: "high_cpu_scale_up"
        enabled: false
            
      # Enable aggressive scale-down for resource conservation
      - rule_id: "low_cpu_scale_down"
        name: "Resource Conservation Scale Down"
        enabled: true
        priority: 3
        cooldown_seconds: 60.0
        action_type: "SCALE_DOWN"
        conditions:
          - metric_name: "cpu_usage"
            operator: "lt"
            value: 40.0  # Higher threshold for aggressive scaling down
            weight: 1.0
          - metric_name: "capacity"
            operator: "gt"
            value: 1  # Scale down to minimum
            weight: 0.5
            
      # Aggressive response time optimization
      - rule_id: "high_response_time_optimize"
        name: "Aggressive Response Time Optimization"
        enabled: true
        priority: 4
        cooldown_seconds: 30.0
        action_type: "OPTIMIZE_CONFIG"
        conditions:
          - metric_name: "response_time"
            operator: "gt"
            value: 200  # Very low threshold (200ms)
            weight: 1.0
            
      # Conservative error rate handling (no restarts to save resources)
      - rule_id: "high_error_rate_restart"
        enabled: false
            
      # Aggressive caching enablement
      - rule_id: "low_throughput_enable_caching"
        name: "Aggressive Caching Enablement"
        enabled: true
        priority: 3
        cooldown_seconds: 30.0
        action_type: "ENABLE_CACHING"
        conditions:
          - metric_name: "throughput"
            operator: "lt"
            value: 40.0  # Higher threshold
            weight: 1.0
          - metric_name: "active_connections"
            operator: "gt"
            value: 20  # Lower threshold
            weight: 0.8
            
      # Aggressive memory QoS adjustment
      - rule_id: "high_memory_adjust_qos"
        name: "Aggressive Memory QoS Adjustment"
        enabled: true
        priority: 4
        cooldown_seconds: 45.0
        action_type: "ADJUST_QOS"
        conditions:
          - metric_name: "memory_usage"
            operator: "gt"
            value: 2048  # Lower threshold (2GB)
            weight: 1.0
            
      # Additional resource optimization rules
      - rule_id: "moderate_cpu_optimize"
        name: "Moderate CPU Optimization"
        enabled: true
        priority: 2
        cooldown_seconds: 90.0
        action_type: "OPTIMIZE_CONFIG"
        conditions:
          - metric_name: "cpu_usage"
            operator: "gt"
            value: 60.0  # Optimize at moderate CPU usage
            weight: 1.0
            
      - rule_id: "connection_limit_qos"
        name: "Connection Limit QoS"
        enabled: true
        priority: 3
        cooldown_seconds: 60.0
        action_type: "ADJUST_QOS"
        conditions:
          - metric_name: "active_connections"
            operator: "gt"
            value: 40
            weight: 1.0

# Resource-focused observability
observability:
  service_name: "polaris-mock-resource-constraint"
  metrics:
    collection_interval: 4
    export_interval: 8
    enable_system_metrics: true  # Focus on system resource metrics
  logging:
    log_level: "INFO"

# Test scenario metadata
scenario:
  name: "resource_constraint"
  description: "Test optimization adaptations under resource constraints"
  expected_adaptations: 4-6
  duration_minutes: 12
  resource_constraints:
    max_capacity: 5  # Limited scaling capacity
    memory_limit: 4096  # 4GB memory limit
    cpu_limit: 80  # 80% CPU limit
  success_criteria:
    - "Scale-down triggered when CPU < 40%"
    - "Configuration optimization triggered when response time > 200ms"
    - "Caching enabled to improve efficiency"
    - "QoS adjustments made under memory pressure"
    - "No scale-up adaptations (resource constrained)"
    - "System maintains functionality with limited resources"