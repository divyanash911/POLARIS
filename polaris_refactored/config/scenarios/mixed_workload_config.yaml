# POLARIS Configuration for Mixed Workload Test Scenario
# This scenario tests handling multiple concurrent adaptation needs

# Inherit from base mock system configuration
extends: "../mock_system_config.yaml"

# Override specific settings for mixed workload scenario
framework:
  service_name: "polaris-mock-system-mixed-workload"
  max_concurrent_adaptations: 8  # Allow more concurrent adaptations
  
managed_systems:
  mock_system:
    system_id: "mock_system_mixed_workload"
    
    # Balanced monitoring for mixed workload
    monitoring_config:
      collection_interval: 3
      
control_reasoning:
  threshold_reactive:
    # Enable all adaptation types with balanced thresholds
    enable_multi_metric_evaluation: true
    action_prioritization_enabled: true
    max_concurrent_actions: 5  # Allow multiple concurrent actions
    
    rules:
      # Moderate CPU scale-up
      - rule_id: "moderate_cpu_scale_up"
        name: "Moderate CPU Scale Up"
        enabled: true
        priority: 3
        cooldown_seconds: 45.0
        action_type: "SCALE_UP"
        conditions:
          - metric_name: "cpu_usage"
            operator: "gt"
            value: 75.0
            weight: 1.0
          - metric_name: "capacity"
            operator: "lt"
            value: 12
            weight: 0.5
            
      # Moderate CPU scale-down
      - rule_id: "moderate_cpu_scale_down"
        name: "Moderate CPU Scale Down"
        enabled: true
        priority: 2
        cooldown_seconds: 90.0
        action_type: "SCALE_DOWN"
        conditions:
          - metric_name: "cpu_usage"
            operator: "lt"
            value: 25.0
            weight: 1.0
          - metric_name: "capacity"
            operator: "gt"
            value: 2
            weight: 0.5
            
      # Response time optimization
      - rule_id: "response_time_optimize"
        name: "Response Time Optimization"
        enabled: true
        priority: 2
        cooldown_seconds: 60.0
        action_type: "OPTIMIZE_CONFIG"
        conditions:
          - metric_name: "response_time"
            operator: "gt"
            value: 400
            weight: 1.0
            
      # Error rate management
      - rule_id: "error_rate_restart"
        name: "Error Rate Service Restart"
        enabled: true
        priority: 4
        cooldown_seconds: 120.0
        action_type: "RESTART_SERVICE"
        conditions:
          - metric_name: "error_rate"
            operator: "gt"
            value: 7.0
            weight: 2.0
            
      # Throughput optimization
      - rule_id: "throughput_caching"
        name: "Throughput Caching Optimization"
        enabled: true
        priority: 2
        cooldown_seconds: 75.0
        action_type: "ENABLE_CACHING"
        conditions:
          - metric_name: "throughput"
            operator: "lt"
            value: 25.0
            weight: 1.0
          - metric_name: "active_connections"
            operator: "gt"
            value: 35
            weight: 0.8
            
      # Memory management
      - rule_id: "memory_qos_adjustment"
        name: "Memory QoS Adjustment"
        enabled: true
        priority: 3
        cooldown_seconds: 80.0
        action_type: "ADJUST_QOS"
        conditions:
          - metric_name: "memory_usage"
            operator: "gt"
            value: 3584  # 3.5GB
            weight: 1.0
            
      # High connection load management
      - rule_id: "high_connection_scale_up"
        name: "High Connection Scale Up"
        enabled: true
        priority: 3
        cooldown_seconds: 60.0
        action_type: "SCALE_UP"
        conditions:
          - metric_name: "active_connections"
            operator: "gt"
            value: 80
            weight: 1.0
          - metric_name: "response_time"
            operator: "gt"
            value: 300
            weight: 0.8
            
      # Low throughput with high CPU - optimization
      - rule_id: "inefficient_processing_optimize"
        name: "Inefficient Processing Optimization"
        enabled: true
        priority: 2
        cooldown_seconds: 90.0
        action_type: "OPTIMIZE_CONFIG"
        conditions:
          - metric_name: "throughput"
            operator: "lt"
            value: 20.0
            weight: 1.0
          - metric_name: "cpu_usage"
            operator: "gt"
            value: 70.0
            weight: 1.0
            
      # Memory leak detection and restart
      - rule_id: "memory_leak_restart"
        name: "Memory Leak Service Restart"
        enabled: true
        priority: 4
        cooldown_seconds: 180.0
        action_type: "RESTART_SERVICE"
        conditions:
          - metric_name: "memory_usage"
            operator: "gt"
            value: 4608  # 4.5GB
            weight: 1.5
          - metric_name: "throughput"
            operator: "lt"
            value: 15.0
            weight: 1.0
            
      # Proactive caching for high load
      - rule_id: "proactive_caching"
        name: "Proactive Caching Enablement"
        enabled: true
        priority: 1
        cooldown_seconds: 120.0
        action_type: "ENABLE_CACHING"
        conditions:
          - metric_name: "cpu_usage"
            operator: "gt"
            value: 65.0
            weight: 0.8
          - metric_name: "memory_usage"
            operator: "gt"
            value: 3072
            weight: 0.8
          - metric_name: "active_connections"
            operator: "gt"
            value: 50
            weight: 1.0

# Comprehensive observability for mixed workload analysis
observability:
  service_name: "polaris-mock-mixed-workload"
  metrics:
    collection_interval: 3
    export_interval: 6
    enable_adaptation_metrics: true
  tracing:
    sample_rate: 0.8  # High sampling for detailed analysis
    enable_adaptation_tracing: true
  logging:
    log_level: "INFO"
    enable_correlation_ids: true

# Test scenario metadata
scenario:
  name: "mixed_workload"
  description: "Test handling multiple concurrent adaptation needs with varying workload patterns"
  expected_adaptations: 8-12
  duration_minutes: 25
  workload_patterns:
    - phase: "startup"
      duration_minutes: 3
      characteristics: ["low_cpu", "low_memory", "few_connections"]
    - phase: "ramp_up"
      duration_minutes: 5
      characteristics: ["increasing_cpu", "increasing_connections", "stable_memory"]
    - phase: "peak_mixed"
      duration_minutes: 8
      characteristics: ["high_cpu", "high_memory", "high_connections", "variable_throughput"]
    - phase: "memory_pressure"
      duration_minutes: 4
      characteristics: ["moderate_cpu", "very_high_memory", "high_connections"]
    - phase: "error_spike"
      duration_minutes: 3
      characteristics: ["high_errors", "degraded_throughput", "high_response_time"]
    - phase: "recovery"
      duration_minutes: 2
      characteristics: ["stabilizing_metrics", "decreasing_load"]
  success_criteria:
    - "Multiple adaptation types triggered concurrently"
    - "Scale-up and scale-down adaptations both occur"
    - "Configuration optimization applied during performance issues"
    - "Caching enabled during high load phases"
    - "QoS adjustments made during memory pressure"
    - "Service restarts executed during error spikes"
    - "System handles concurrent adaptations without conflicts"
    - "All adaptation priorities respected"
    - "System recovers to stable state at end"
    - "No adaptation deadlocks or infinite loops"