# POLARIS Configuration for High Load Test Scenario
# This scenario tests scale-up adaptations under high system load

# Inherit from base mock system configuration
extends: "../mock_system_config.yaml"

# Override specific settings for high load scenario
framework:
  service_name: "polaris-mock-system-high-load"
  
managed_systems:
  mock_system:
    system_id: "mock_system_high_load"
    
    # More frequent monitoring for high load scenario
    monitoring_config:
      collection_interval: 3  # Very frequent monitoring
      
control_reasoning:
  threshold_reactive:
    # Aggressive thresholds to trigger scale-up adaptations
    rules:
      # High CPU threshold - lower to trigger easily
      - rule_id: "high_cpu_scale_up"
        name: "High CPU Scale Up"
        enabled: true
        priority: 3
        cooldown_seconds: 30.0  # Shorter cooldown for testing
        action_type: "SCALE_UP"
        conditions:
          - metric_name: "cpu_usage"
            operator: "gt"
            value: 70.0  # Lower threshold to trigger easily
            weight: 1.0
          - metric_name: "capacity"
            operator: "lt"
            value: 15  # Allow more scaling
            weight: 0.5
            
      # Disable scale-down to focus on scale-up testing
      - rule_id: "low_cpu_scale_down"
        enabled: false
            
      # High response time threshold - lower to trigger easily
      - rule_id: "high_response_time_optimize"
        name: "High Response Time Optimization"
        enabled: true
        priority: 2
        cooldown_seconds: 45.0
        action_type: "OPTIMIZE_CONFIG"
        conditions:
          - metric_name: "response_time"
            operator: "gt"
            value: 300  # Lower threshold (300ms)
            weight: 1.0
            
      # High error rate threshold - lower to trigger easily
      - rule_id: "high_error_rate_restart"
        name: "High Error Rate Service Restart"
        enabled: true
        priority: 4
        cooldown_seconds: 180.0
        action_type: "RESTART_SERVICE"
        conditions:
          - metric_name: "error_rate"
            operator: "gt"
            value: 5.0  # Lower threshold (5%)
            weight: 2.0
            
      # Enable caching for high load
      - rule_id: "low_throughput_enable_caching"
        name: "Low Throughput Enable Caching"
        enabled: true
        priority: 2
        cooldown_seconds: 60.0
        action_type: "ENABLE_CACHING"
        conditions:
          - metric_name: "throughput"
            operator: "lt"
            value: 30.0  # Higher threshold for high load scenario
            weight: 1.0
          - metric_name: "active_connections"
            operator: "gt"
            value: 30  # Lower threshold
            weight: 0.8
            
      # Memory QoS adjustment
      - rule_id: "high_memory_adjust_qos"
        name: "High Memory Usage QoS Adjustment"
        enabled: true
        priority: 2
        cooldown_seconds: 90.0
        action_type: "ADJUST_QOS"
        conditions:
          - metric_name: "memory_usage"
            operator: "gt"
            value: 3072  # Lower threshold (3GB)
            weight: 1.0

# Enhanced observability for high load testing
observability:
  service_name: "polaris-mock-high-load"
  metrics:
    collection_interval: 3   # Very frequent collection
    export_interval: 6       # Frequent export
  tracing:
    sample_rate: 1.0  # 100% sampling for detailed analysis
  logging:
    log_level: "DEBUG"  # Detailed logging for analysis

# Test scenario metadata
scenario:
  name: "high_load"
  description: "Test system behavior under high load with expected scale-up adaptations"
  expected_adaptations: 3-5
  duration_minutes: 15
  load_simulation:
    initial_load: 0.3
    peak_load: 0.9
    ramp_up_minutes: 5
    sustain_minutes: 5
    ramp_down_minutes: 5
  success_criteria:
    - "Scale-up adaptations triggered when CPU > 70%"
    - "Response time optimization triggered when latency > 300ms"
    - "System performance improves after adaptations"
    - "No critical errors during load"
    - "Caching enabled under high connection load"