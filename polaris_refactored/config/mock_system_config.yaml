# POLARIS Framework Configuration for Mock External System Testing
# Complete configuration for running POLARIS with mock external system
# for comprehensive testing of all framework components

# Framework Core Configuration
framework:
  service_name: "polaris-mock-system-test"
  version: "2.0.0"
  environment: "development"
  
  # NATS Message Bus Configuration
  nats_config:
    servers:
      - "nats://localhost:4222"
    username: null
    password: null
    token: null
    timeout: 30
    
  # Telemetry Configuration
  telemetry_config:
    enabled: true
    collection_interval: 5  # seconds - frequent for testing
    batch_size: 50
    retention_days: 7
    
  # Logging Configuration
  logging_config:
    level: "INFO"
    format: "text"
    output: "console"
    file_path: "./logs/polaris_mock_system.log"
    max_file_size: 10485760  # 10MB
    backup_count: 5
    
  # Framework Settings
  plugin_search_paths:
    - "./plugins"
  max_concurrent_adaptations: 5
  adaptation_timeout: 120  # seconds

# Managed Systems Configuration
managed_systems:
  mock_system:
    system_id: "mock_system"
    connector_type: "mock_system"
    enabled: true
    
    # Mock System Connection Configuration
    connection:
      host: "localhost"
      port: 5000
      
    # Mock System Implementation Configuration
    implementation:
      timeout: 10.0
      max_retries: 3
      retry_delay: 1.0
      
    # Monitoring Configuration
    monitoring_config:
      collection_interval: 5  # seconds - frequent for testing
      collection_strategy: "polling_direct_connector"
      health_check_interval: 15
      metrics_to_collect:
        - "cpu_usage"
        - "memory_usage"
        - "response_time"
        - "throughput"
        - "error_rate"
        - "active_connections"
        - "capacity"

# Control & Reasoning Configuration
control_reasoning:
  # Adaptive Controller Configuration
  adaptive_controller:
    enabled: true
    control_strategies:
      - "threshold_reactive"
    enable_pid_strategy: false
    enable_enhanced_assessment: true
    
  # Threshold Reactive Strategy Configuration
  threshold_reactive:
    enabled: true
    enable_multi_metric_evaluation: true
    action_prioritization_enabled: true
    max_concurrent_actions: 3
    default_cooldown_seconds: 60.0
    enable_fallback: true
    
    # Threshold Rules for Mock System Testing
    rules:
      # High CPU Utilization - Scale Up
      - rule_id: "high_cpu_scale_up"
        name: "High CPU Scale Up"
        description: "Scale up when CPU utilization is high"
        enabled: true
        priority: 3
        cooldown_seconds: 60.0
        logical_operator: "and"
        action_type: "SCALE_UP"
        action_parameters:
          reason: "high_cpu_utilization"
        conditions:
          - metric_name: "cpu_usage"
            operator: "gt"
            value: 80.0
            weight: 1.0
            description: "CPU usage above 80%"
          - metric_name: "capacity"
            operator: "lt"
            value: 10  # Don't scale beyond 10 units
            weight: 0.5
            
      # Low CPU Utilization - Scale Down
      - rule_id: "low_cpu_scale_down"
        name: "Low CPU Scale Down"
        description: "Scale down when CPU utilization is low"
        enabled: true
        priority: 2
        cooldown_seconds: 120.0
        logical_operator: "and"
        action_type: "SCALE_DOWN"
        action_parameters:
          reason: "low_cpu_utilization"
        conditions:
          - metric_name: "cpu_usage"
            operator: "lt"
            value: 20.0
            weight: 1.0
            description: "CPU usage below 20%"
          - metric_name: "capacity"
            operator: "gt"
            value: 2  # Keep at least 2 capacity units
            weight: 0.5
            
      # High Response Time - Optimize Configuration
      - rule_id: "high_response_time_optimize"
        name: "High Response Time Optimization"
        description: "Optimize configuration when response time is high"
        enabled: true
        priority: 2
        cooldown_seconds: 90.0
        logical_operator: "or"
        action_type: "OPTIMIZE_CONFIG"
        action_parameters:
          reason: "high_response_time"
        conditions:
          - metric_name: "response_time"
            operator: "gt"
            value: 500  # milliseconds
            weight: 1.0
            description: "Response time above 500ms"
            
      # High Error Rate - Restart Service
      - rule_id: "high_error_rate_restart"
        name: "High Error Rate Service Restart"
        description: "Restart service when error rate is high"
        enabled: true
        priority: 4
        cooldown_seconds: 300.0  # 5 minutes cooldown for restarts
        logical_operator: "and"
        action_type: "RESTART_SERVICE"
        action_parameters:
          reason: "high_error_rate"
        conditions:
          - metric_name: "error_rate"
            operator: "gt"
            value: 10.0  # 10% error rate
            weight: 2.0
            description: "Error rate above 10%"
            
      # Low Throughput with High Connections - Enable Caching
      - rule_id: "low_throughput_enable_caching"
        name: "Low Throughput Enable Caching"
        description: "Enable caching when throughput is low despite high connections"
        enabled: true
        priority: 2
        cooldown_seconds: 180.0
        logical_operator: "and"
        action_type: "ENABLE_CACHING"
        action_parameters:
          reason: "low_throughput_high_connections"
        conditions:
          - metric_name: "throughput"
            operator: "lt"
            value: 20.0  # requests per second
            weight: 1.0
            description: "Throughput below 20 req/s"
          - metric_name: "active_connections"
            operator: "gt"
            value: 50
            weight: 0.8
            description: "High number of active connections"
            
      # Memory Usage - Adjust QoS
      - rule_id: "high_memory_adjust_qos"
        name: "High Memory Usage QoS Adjustment"
        description: "Adjust QoS when memory usage is high"
        enabled: true
        priority: 2
        cooldown_seconds: 120.0
        logical_operator: "and"
        action_type: "ADJUST_QOS"
        action_parameters:
          reason: "high_memory_usage"
          qos_level: "reduced"
        conditions:
          - metric_name: "memory_usage"
            operator: "gt"
            value: 4096  # MB
            weight: 1.0
            description: "Memory usage above 4GB"
            
    # Severity Weights
    severity_weights:
      critical: 3.0
      high: 2.0
      medium: 1.0
      low: 0.5

# Digital Twin Configuration (Minimal for testing)
digital_twin:
  # World Model Configuration
  world_model:
    type: "statistical"  # Use simple statistical model for testing
    conversation_history_limit: 10
    enable_fallback_model: false
    
  # Knowledge Base Configuration
  knowledge_base:
    enabled: false  # Disabled for basic testing
    
  # Learning Engine Configuration
  learning_engine:
    enabled: false  # Disabled for basic testing

# Data Storage Configuration
data_storage:
  # Use in-memory storage for testing
  backends:
    time_series: "in_memory"
    document: "in_memory"
    graph: "in_memory"
  
  # Repository Configuration
  repositories:
    system_state:
      retention_hours: 24  # 1 day for testing
      max_entries: 1000
    adaptation_actions:
      retention_hours: 24  # 1 day for testing
      max_entries: 500
    execution_results:
      retention_hours: 24  # 1 day for testing
      max_entries: 500

# Event Bus Configuration
event_bus:
  max_queue_size: 1000
  worker_count: 2
  enable_event_history: true
  event_history_limit: 500

# Observability Configuration
observability:
  service_name: "polaris-mock-system-test"
  enable_metrics: true
  enable_tracing: true
  enable_logging: true
  
  # Metrics Configuration
  metrics:
    collection_interval: 5   # Frequent collection for testing
    export_interval: 10      # Frequent export for testing
    enable_system_metrics: true
    enable_adaptation_metrics: true
    enable_llm_metrics: false  # Disabled since no LLM in basic testing
    
  # Tracing Configuration
  tracing:
    sample_rate: 1.0  # 100% sampling for testing
    enable_adaptation_tracing: true
    enable_llm_tracing: false
    
  # Logging Configuration
  logging:
    enable_structured_logging: true
    log_level: "INFO"
    enable_correlation_ids: true

# Plugin Configuration
plugins:
  mock_system:
    enabled: true
    auto_load: true
    config_validation: true

# Environment-specific Overrides
development:
  framework:
    logging_config:
      level: "DEBUG"
      format: "text"
  observability:
    tracing:
      sample_rate: 1.0  # 100% sampling for development
    logging:
      log_level: "DEBUG"

testing:
  framework:
    logging_config:
      level: "INFO"
      output: "console"
  control_reasoning:
    threshold_reactive:
      default_cooldown_seconds: 30.0  # Shorter cooldowns for testing
  observability:
    metrics:
      collection_interval: 2  # Very frequent for testing
      export_interval: 5
    tracing:
      sample_rate: 1.0  # 100% sampling for testing

production:
  framework:
    logging_config:
      level: "INFO"
      output: "file"
  control_reasoning:
    threshold_reactive:
      default_cooldown_seconds: 120.0  # Longer cooldowns in production
  observability:
    tracing:
      sample_rate: 0.1  # Lower sampling in production