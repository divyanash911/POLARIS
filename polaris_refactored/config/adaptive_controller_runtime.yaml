# Adaptive Controller Enhanced Configuration
# ==========================================
# This file integrates with the POLARIS configuration system and supports
# evolvable thresholds that can be modified by the Meta Learner over time.
# Each threshold includes evolution metadata for tracking changes and performance.
#
# Location: config/adaptive_controller_runtime.yaml
# Version: 2 (Enhanced with evolvable thresholds)

version: 2
last_updated: "2026-01-10T12:00:00Z"
updated_by: "system"

# =============================================================================
# Evolvable Thresholds Configuration
# =============================================================================
# Each threshold is now an object with value, constraints, and evolution metadata.
# The meta learner can adjust these based on observed system behavior and performance.

thresholds:
  # CPU utilization thresholds
  cpu_high:
    value: 80.0
    min_value: 50.0
    max_value: 95.0
    metadata:
      last_updated: "2026-01-10T12:00:00Z"
      updated_by: "system"
      confidence_score: 1.0
      performance_impact: null
      change_reason: "initial_value"
      previous_value: null
      evolution_count: 0
  
  cpu_low:
    value: 20.0
    min_value: 5.0
    max_value: 50.0
    metadata:
      last_updated: "2026-01-10T12:00:00Z"
      updated_by: "system"
      confidence_score: 1.0
      performance_impact: null
      change_reason: "initial_value"
      previous_value: null
      evolution_count: 0
  
  cpu_critical:
    value: 95.0
    min_value: 85.0
    max_value: 99.0
    metadata:
      last_updated: "2026-01-10T12:00:00Z"
      updated_by: "system"
      confidence_score: 1.0
      performance_impact: null
      change_reason: "initial_value"
      previous_value: null
      evolution_count: 0
  
  # Memory utilization thresholds  
  memory_high:
    value: 85.0
    min_value: 60.0
    max_value: 95.0
    metadata:
      last_updated: "2026-01-10T12:00:00Z"
      updated_by: "system"
      confidence_score: 1.0
      performance_impact: null
      change_reason: "initial_value"
      previous_value: null
      evolution_count: 0
  
  memory_critical:
    value: 95.0
    min_value: 85.0
    max_value: 99.0
    metadata:
      last_updated: "2026-01-10T12:00:00Z"
      updated_by: "system"
      confidence_score: 1.0
      performance_impact: null
      change_reason: "initial_value"
      previous_value: null
      evolution_count: 0
  
  # Response time thresholds
  response_time_warning_ms:
    value: 200.0
    min_value: 50.0
    max_value: 1000.0
    metadata:
      last_updated: "2026-01-10T12:00:00Z"
      updated_by: "system"
      confidence_score: 1.0
      performance_impact: null
      change_reason: "initial_value"
      previous_value: null
      evolution_count: 0
  
  response_time_critical_ms:
    value: 500.0
    min_value: 200.0
    max_value: 2000.0
    metadata:
      last_updated: "2026-01-10T12:00:00Z"
      updated_by: "system"
      confidence_score: 1.0
      performance_impact: null
      change_reason: "initial_value"
      previous_value: null
      evolution_count: 0
  
  # Error rate thresholds
  error_rate_warning_pct:
    value: 5.0
    min_value: 1.0
    max_value: 20.0
    metadata:
      last_updated: "2026-01-10T12:00:00Z"
      updated_by: "system"
      confidence_score: 1.0
      performance_impact: null
      change_reason: "initial_value"
      previous_value: null
      evolution_count: 0
  
  error_rate_critical_pct:
    value: 10.0
    min_value: 5.0
    max_value: 30.0
    metadata:
      last_updated: "2026-01-10T12:00:00Z"
      updated_by: "system"
      confidence_score: 1.0
      performance_impact: null
      change_reason: "initial_value"
      previous_value: null
      evolution_count: 0
  
  # Throughput thresholds
  throughput_low:
    value: 10.0
    min_value: 1.0
    max_value: 100.0
    metadata:
      last_updated: "2026-01-10T12:00:00Z"
      updated_by: "system"
      confidence_score: 1.0
      performance_impact: null
      change_reason: "initial_value"
      previous_value: null
      evolution_count: 0

# =============================================================================
# Strategy Configuration
# =============================================================================
# Weights for strategy selection and behavior tuning.

strategy_weights:
  reactive: 1.0           # ThresholdReactiveStrategy weight
  predictive: 0.8         # PredictiveControlStrategy weight
  learning: 0.6           # LearningControlStrategy weight

strategy_params:
  # Reactive strategy parameters
  reactive:
    severity_multiplier: 1.0
    enable_multi_metric: true
    
  # Predictive strategy parameters
  predictive:
    prediction_horizon_minutes: 5
    confidence_threshold: 0.7
    
  # Learning strategy parameters
  learning:
    similarity_threshold: 0.8
    pattern_weight: 0.7

# =============================================================================
# Cooldown Configuration
# =============================================================================
# Minimum time between actions to prevent oscillation.

cooldowns:
  default_seconds: 60.0           # Default cooldown for any action
  scale_up_seconds: 30.0          # Faster cooldown for scaling up (urgent)
  scale_down_seconds: 120.0       # Slower cooldown for scaling down (cautious)
  restart_seconds: 300.0          # Long cooldown for service restarts
  config_change_seconds: 180.0    # Cooldown for configuration changes
  emergency_override: false       # If true, ignore cooldowns for critical events

# =============================================================================
# Limits Configuration
# =============================================================================
# Operational limits to prevent runaway adaptations.

limits:
  max_concurrent_actions: 5       # Maximum simultaneous adaptation actions
  max_scale_factor: 3             # Maximum scaling multiplier
  min_capacity: 1                 # Minimum system capacity
  max_capacity: 20                # Maximum system capacity
  max_actions_per_hour: 30        # Rate limiting for adaptations

# =============================================================================
# Feature Configuration
# =============================================================================
# Enable/disable specific controller features.

features:
  enable_predictive: true         # Enable predictive control strategies
  enable_learning: true           # Enable learning-based strategies
  enable_enhanced_assessment: true # Enable enhanced adaptation assessment
  enable_multi_metric_evaluation: true # Enable multi-metric decision making
  enable_action_prioritization: true # Enable action priority ranking
  enable_fallback_actions: true   # Enable fallback action generation

# =============================================================================
# Evolution Configuration
# =============================================================================
# Settings for threshold evolution by the meta learner.

evolution:
  enable_threshold_evolution: true    # Allow meta learner to evolve thresholds
  evolution_confidence_threshold: 0.7 # Minimum confidence to apply changes
  max_evolution_rate_per_hour: 5      # Maximum threshold changes per hour
  require_performance_validation: true # Require performance improvement validation
  rollback_on_degradation: true      # Auto-rollback if performance degrades
  
# =============================================================================
# Action Limits
# =============================================================================
# Bounds on adaptation actions to prevent runaway behavior.

limits:
  max_concurrent_actions: 5       # Maximum actions in parallel
  max_scale_factor: 3             # Maximum scale multiplier per action
  min_capacity: 1                 # Minimum system capacity
  max_capacity: 20                # Maximum system capacity
  max_actions_per_hour: 30        # Rate limit on total actions
  
# =============================================================================
# Feature Toggles
# =============================================================================
# Enable/disable specific adaptation features.

features:
  enable_predictive: true                 # Use world model predictions
  enable_learning: true                   # Use learned patterns from KB
  enable_enhanced_assessment: true        # Enhanced adaptation assessment
  enable_multi_metric_evaluation: true    # Evaluate multiple metrics together
  enable_action_prioritization: true      # Prioritize actions by severity
  enable_fallback_actions: true           # Fallback when primary action fails

# =============================================================================
# Meta Learner Integration
# =============================================================================
# Settings for meta learner interaction with this configuration.

meta_learner:
  # Which fields the meta learner is allowed to modify
  writable_fields:
    - "thresholds.*"
    - "strategy_weights.*"
    - "cooldowns.*"
    - "limits.max_concurrent_actions"
    - "limits.max_actions_per_hour"
    - "features.*"
  
  # Validation constraints
  constraints:
    thresholds:
      min: 0.0
      max: 100.0
    cooldowns:
      min: 10.0
      max: 3600.0
    limits:
      max_capacity_max: 100
      min_capacity_min: 1
